<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jeu du Mariage</title>
  <link rel="stylesheet" href="styles.css" /> <!-- Si tu as un CSS, garde-le -->
</head>
<body>
  <div id="jeu">
    <h1>Jeu du Mariage</h1>
    <div id="grille"></div>
    <button id="nouvelle-partie">Nouvelle Partie</button>
    <p id="temps">Temps : 0s</p>
    <div id="modal" class="modal">
      <div class="modal-content">
        <h2>Félicitations !</h2>
        <p>Vous avez terminé en <span id="temps-final"></span> secondes !</p>
        <input type="text" id="pseudo" placeholder="Entrez votre pseudo" />
        <button id="enregistrer">Enregistrer le score</button>
      </div>
    </div>
    <div id="classement">
      <!-- Le classement sera chargé ici -->
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js"></script>

  <script>
    // Configuration Firebase (remplace par TES valeurs depuis console.firebase.google.com > Paramètres du projet)
const firebaseConfig = {
  apiKey: "AIzaSyAAIr_vGlCMM9iuRwnqOQhb2cwv7DIVJFk",
  authDomain: "classementjeu-a2f8a.firebaseapp.com",
  projectId: "classementjeu-a2f8a",
  storageBucket: "classementjeu-a2f8a.firebasestorage.app",
  messagingSenderId: "70538879353",
  appId: "1:70538879353:web:05b35cb2c3930c34380fa8",
  measurementId: "G-JXNCRWDN5C"
};



    // Initialiser Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore(app);

    // Variables pour le timer (mesure automatique du temps)
    let startTime = null;
    let timerInterval = null;

    // Fonction pour démarrer le timer
    function startTimer() {
      startTime = Date.now();
      timerInterval = setInterval(updateTimerDisplay, 1000);  // Met à jour l'affichage toutes les secondes
    }

    // Fonction pour mettre à jour l'affichage du temps (en secondes)
    function updateTimerDisplay() {
      if (startTime) {
        const elapsed = Math.floor((Date.now() - startTime) / 1000);
        document.getElementById("temps").textContent = `Temps : ${elapsed}s`;
      }
    }

    // Fonction pour arrêter le timer et retourner le temps final en secondes
    function stopTimer() {
      clearInterval(timerInterval);
      if (startTime) {
        return ((Date.now() - startTime) / 1000).toFixed(1);  // Temps en secondes avec 1 décimale
      }
      return 0;
    }

    // Fonction pour enregistrer un score dans Firestore
    function enregistrerScore(pseudo, temps) {
      if (!pseudo || !temps) {
        alert("Veuillez entrer un pseudo.");
        return;
      }

      db.collection("scores").add({
        pseudo: pseudo,
        temps: parseFloat(temps),  // Assure-toi que c'est un nombre
        date: firebase.firestore.FieldValue.serverTimestamp()  // Date automatique du serveur
      })
      .then(() => {
        console.log("Score enregistré avec succès !");
        // Pas besoin de recharger manuellement le classement (onSnapshot s'en occupe)
        document.getElementById("modal").style.display = "none";  // Ferme le modal
      })
      .catch((error) => {
        console.error("Erreur d'enregistrement du score :", error);
        alert("Erreur lors de l'enregistrement du score.");
      });
    }

    // Fonction pour charger et afficher le classement en TEMPS RÉEL (avec onSnapshot)
    function chargerClassement() {
      db.collection("scores")
        .orderBy("temps", "asc")  // Tri par temps croissant (meilleurs en premier)
        .limit(10)  // Limite au top 10
        .onSnapshot((querySnapshot) => {  // Écoute les changements en temps réel
          const classement = [];
          querySnapshot.forEach((doc) => {
            const data = doc.data();
            classement.push({
              pseudo: data.pseudo,
              temps: data.temps,
              date: data.date ? data.date.toDate().toLocaleString('fr-FR') : 'Inconnu'  // Format date française
            });
          });

          // Affiche dans le HTML
          const classementDiv = document.getElementById("classement");
          classementDiv.innerHTML = "<h2>Classement des Meilleurs Temps</h2><ol>";
          if (classement.length === 0) {
            classementDiv.innerHTML += "<li>Aucun score pour le moment.</li>";
          } else {
            classement.forEach((score) => {
              classementDiv.innerHTML += `<li>${score.pseudo} - ${score.temps} secondes (${score.date})</li>`;
            });
          }
          classementDiv.innerHTML += "</ol>";
        }, (error) => {
          console.error("Erreur de chargement du classement :", error);
          document.getElementById("classement").innerHTML = "<p>Erreur lors du chargement du classement.</p>";
        });
    }

    // Logique de base du jeu
    document.getElementById("nouvelle-partie").addEventListener("click", function() {
      // Logique de nouvelle partie (à implémenter : générer grille, etc.)
      console.log("Nouvelle partie démarrée !");
      startTimer();  // Démarre le timer automatique

      // Simulation de fin de jeu après 10 secondes (REMPLACE PAR TA VRAIE LOGIQUE DE VICTOIRE, ex. quand toutes les paires sont trouvées)
      setTimeout(() => {
        const tempsFinal = stopTimer();  // Arrête le timer et récupère le temps automatique
        document.getElementById("temps-final").textContent = tempsFinal;
        document.getElementById("modal").style.display = "block";  // Affiche le modal
      }, 10000);  // 10 secondes pour la simulation – adapte ou supprime
    });

    // Événement pour enregistrer le score depuis le modal
    document.getElementById("enregistrer").addEventListener("click", function() {
      const pseudo = document.getElementById("pseudo").value;
      const temps = document.getElementById("temps-final").textContent;  // Temps calculé automatiquement
      enregistrerScore(pseudo, temps);
    });

    // Charge le classement au démarrage de la page (en temps réel)
    window.onload = function() {
      chargerClassement();
      // Autre initialisation de ton jeu ici si needed
    };
  </script>
</body>
</html>
