<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jeu de Recherche Visuelle - Mariage</title>
  <style>
    body { font-family: sans-serif; text-align: center; background-color: #fef8f4; }
    #game-container { position: relative; display: inline-block; }
    #wedding-image { max-width: 100%; height: auto; }
    .target { position: absolute; border: 2px solid transparent; cursor: pointer; }
    .found { border-color: green; }
    #current-word { font-size: 1.5em; margin: 10px; }
    #results, #leaderboard { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>üéØ Jeu de Recherche - Sp√©cial Mariage</h1>
  <div id="current-word">
  Cliquez sur : <strong id="word"></strong><br>
  ‚è±Ô∏è Temps : <span id="timer">0.0</span> sec
</div>

  <div id="game-container">
    <img id="wedding-image" src="scene.png" alt="Sc√®ne de mariage" />
  </div>
  <div id="results"></div>
  <div id="leaderboard"><h2>üèÜ Classement</h2><ul id="scores"></ul></div>

  <script>
    const mots = ["Cravate", "Clef de voiture", "Pi√®ce de monnaie en cuivre", "Stylo bille", "Briquet", "Mouchoir tissu", "Rouge √† l√®vres", "Nain de jardin", "Chaussure", "Bretelles", "Permis de conduire", "La Mari√©e"];
    const zones = [
      { nom: "Cravate", x: 13, y: 60, w: 6, h: 6, intrus: false },
      { nom: "Clef de voiture", x: 18, y: 63, w: 6, h: 6, intrus: false },
      { nom: "Pi√®ce de monnaie en cuivre", x: 22, y: 61, w: 3, h: 4, intrus: false },
      { nom: "Stylo bille", x: 30, y: 73, w: 6, h: 5, intrus: false },
      { nom: "Briquet", x: 25, y: 70, w: 3, h: 5, intrus: false },
      { nom: "Mouchoir tissu", x: 10, y: 55, w: 6, h: 6, intrus: false },
      { nom: "Rouge √† l√®vres", x: 50, y: 75, w: 4, h: 6, intrus: false },
      { nom: "Nain de jardin", x: 7, y: 85, w: 4, h: 6, intrus: false },
      { nom: "Chaussure", x: 75, y: 80, w: 10, h: 8, intrus: false },
      { nom: "Bretelles", x: 82, y: 63, w: 10, h: 10, intrus: false },
      { nom: "Permis de conduire", x: 70, y: 75, w: 8, h: 5, intrus: false },
      { nom: "La Mari√©e", x: 37, y: 35, w: 10, h: 20, intrus: false },
      { nom: "Le Mari√©", x: 55, y: 35, w: 10, h: 20, intrus: true }
    ];

    const scriptUrl = "https://script.google.com/macros/s/AKfycbyDC7VLU8138UqWN-10qdQq6uURRh_D-mbf8zCw7D7dlk7jCoQqFVsv0CxelqML8xLf/exec";

    const container = document.getElementById("game-container");
    const wordDisplay = document.getElementById("word");
    const results = document.getElementById("results");
    const scoresList = document.getElementById("scores");
	let index = 0, startTime = 0, totalPenalty = 0, times = [];
    let intervalId = null;
	const timerDisplay = document.getElementById("timer");


    function showWord() {
  wordDisplay.textContent = mots[index];
  startTime = Date.now();
  if (intervalId) clearInterval(intervalId);
  intervalId = setInterval(() => {
    const t = (Date.now() - startTime) / 1000;
    timerDisplay.textContent = t.toFixed(1);
  }, 100);
}

    function endGame() {
      const total = times.reduce((a, b) => a + b, 0) + totalPenalty;
      results.innerHTML = `<h2>R√©sultat :</h2>`;
      mots.forEach((m, i) => {
        results.innerHTML += `<p>${m} : ${times[i].toFixed(2)} sec</p>`;
      });
      if (totalPenalty > 0) results.innerHTML += `<p>P√©nalit√© : +${totalPenalty} sec</p>`;
      results.innerHTML += `<h3>Temps total : ${total.toFixed(2)} sec</h3>`;

      const pseudo = prompt("Entrez votre pseudo pour le classement :");
      if (pseudo) {
        fetch(scriptUrl, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ pseudo: pseudo, temps: total.toFixed(2) })
        }).then(loadLeaderboard);
      }
    }

    function setupZones() {
      zones.forEach(zone => {
        const div = document.createElement("div");
        div.classList.add("target");
        div.style.left = zone.x + "%";
        div.style.top = zone.y + "%";
        div.style.width = zone.w + "%";
        div.style.height = zone.h + "%";
        div.dataset.nom = zone.nom;
        div.dataset.intrus = zone.intrus;
        div.onclick = () => handleClick(zone);
        container.appendChild(div);
      });
    }

    function handleClick(zone) {
      if (zone.intrus) {
        totalPenalty += 1;
        alert(`Intrus cliqu√© : ${zone.nom} (+1s)`);
        return;
      }
      if (zone.nom === mots[index]) {
        const timeTaken = (Date.now() - startTime) / 1000;
        times.push(timeTaken);
        index++;
        if (index < mots.length) showWord();
        else {
          wordDisplay.textContent = "‚úîÔ∏è Termin√© !";
          endGame();
        }
      }
    }

    function loadLeaderboard() {
      fetch(scriptUrl)
        .then(r => r.json())
        .then(data => {
          scoresList.innerHTML = "";
          data.forEach(entry => {
            scoresList.innerHTML += `<li><strong>${entry.pseudo}</strong> : ${entry.temps} s</li>`;
          });
        });
    }

    setupZones();
    showWord();
    loadLeaderboard();
	clearInterval(intervalId);
  </script>
</body>
</html>
